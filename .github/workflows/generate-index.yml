name: Auto Generate index.json

on:
  push:
    paths:
      - "scripts/**"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Generate index.json
        run: |
          echo "[" > index.json
          first=true
          for file in scripts/*; do
            if [ "$first" = true ]; then
              first=false
            else
              echo "," >> index.json
            fi
            name=$(basename "$file")
            raw="https://raw.githubusercontent.com/${{ github.repository }}/main/$file"
            echo "  {\"name\": \"$name\", \"raw\": \"$raw\"}" >> index.json
          done
          echo "]" >> index.json

      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add index.json
          git commit -m "Auto update index.json" || exit 0
          git push
